<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="generator" content="Hugo 0.51-DEV" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fighting targeted backdoors with secure multiparty code reviews and a SSOT | Frank Braun</title>
    <meta name="description" content="2018-10-06 [read as txt or PDF]">
    <meta name="keywords" content="">
    
    
    
    
    

  <meta name="author" content="Frank Braun">


    <meta property="og:title" content="Fighting targeted backdoors with secure multiparty code reviews and a SSOT" />
<meta property="og:description" content="2018-10-06 [read as txt or PDF]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://frankbraun.org/essay/fighting-targeted-backdoors/" /><meta property="article:published_time" content="2018-10-06T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-10-06T00:00:00&#43;00:00"/>

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fighting targeted backdoors with secure multiparty code reviews and a SSOT"/>
<meta name="twitter:description" content="2018-10-06 [read as txt or PDF]"/>

    




    

    
    
  <meta name="referrer" content="same-origin">


    <script>
 
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.fetchInject=t()}(this,function(){"use strict";const e=function(e,t,n,r,o,c,i){c=t.createElement(n),i=t.getElementsByTagName(n)[0],c.appendChild(t.createTextNode(r.text)),c.onload=o(r),i?i.parentNode.insertBefore(c,i):t.head.appendChild(c)};return function(t,n){if(!arguments.length)return Promise.reject(new ReferenceError("Failed to execute 'fetchInject': 1 argument required but only 0 present."));if(arguments[0]&&arguments[0].constructor!==Array)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 1 must be of type 'Array'."));if(arguments[1]&&arguments[1].constructor!==Promise)return Promise.reject(new TypeError("Failed to execute 'fetchInject': argument 2 must be of type 'Promise'."));const r=[],o=n?[].concat(n):[],c=[];return t.forEach(e=>o.push(window.fetch(e).then(e=>[e.clone().text(),e.blob()]).then(e=>Promise.all(e).then(e=>{r.push({text:e[0],blob:e[1]})})))),Promise.all(o).then(()=>(r.forEach(t=>{c.push({then:n=>{t.blob.type.includes("text/css")?e(window,document,"style",t,n):e(window,document,"script",t,n)}})}),Promise.all(c)))}});
fetchInject(["/js/lazysizes.min.js"]);
</script>

    



    
    <link rel="canonical" href="http://frankbraun.org/essay/fighting-targeted-backdoors/">
    
    
    <link rel="icon" sizes="any" href="data:image/svg+xml,%3Csvg%20viewBox='0%200%2046%2045'%20xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EAfter%20Dark%3C/title%3E%3Cpath%20d='M.708%2045L23%20.416%2045.292%2045H.708zM35%2038L23%2019%2011%2038h24z'%20fill='%23000'/%3E%3C/svg%3E">

    

  
  
  
  
  
  
  
    
      
        <style>html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#ff2e88;text-decoration:none;border-bottom:1px solid #ff2e88}a:hover{background-color:#ff2e88;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:0 0 auto}}.hack,.hack blockquote,.hack code,.hack em,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a) ".";counter-increment:a}.hack ol li:nth-child(n+10):after{left:-7px}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"*";display:inline}.hack pre code:after,.hack pre code:before{content:""}.hack code{font-weight:700}.hack code:after,.hack code:before{content:"`";display:inline}.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:"";border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#ff9800!important;border-color:#ff9800!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:transparent}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:"";width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:transparent}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:transparent}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#ff9800;border:1px solid #ff9800}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#ff9800;color:#ff9800}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#ff9800;border-color:#ff9800}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{display:inline-block;content:"&nbsp;";height:20px;width:20px;margin:0 .5rem;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{margin-bottom:0;width:14px;height:14px}.btn div.loading{float:left}.alert .loading{margin-bottom:-5px}@keyframes a{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:transparent}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}.dark{color:#ccc}.dark,.dark pre{background-color:#000}.dark pre{padding:0;border:none}.dark pre code{color:#00bcd4}.dark h1 a,.dark h2 a,.dark h3 a,.dark h4 a,.dark h5 a{color:#ccc}.dark code,.dark strong{color:#fff}.dark code{font-weight:100}.dark table{color:#ccc}.dark table td,.dark table th{border-color:#444}.dark table tbody td:first-child{color:#fff}.dark .form-group label{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-group.form-textarea label:after{background-color:#000}.dark .form-control{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-control:focus{border-color:#ccc;color:#ccc}.dark textarea.form-control{color:#ccc}.dark .card{border-color:rgba(95,95,95,.78)}.dark .card .card-header{background-color:transparent;color:#ccc;border-bottom:1px solid rgba(95,95,95,.78)}.dark .btn.btn-ghost.btn-default{border-color:#ababab;color:#ababab}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#9c9c9c;color:#9c9c9c;z-index:1}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#e0e0e0;color:#e0e0e0}.dark .btn.btn-ghost.btn-primary:focus,.dark .btn.btn-ghost.btn-primary:hover{border-color:#64b5f6;color:#64b5f6}.dark .btn.btn-ghost.btn-success:focus,.dark .btn.btn-ghost.btn-success:hover{border-color:#81c784;color:#81c784}.dark .btn.btn-ghost.btn-info:focus,.dark .btn.btn-ghost.btn-info:hover{border-color:#4dd0e1;color:#4dd0e1}.dark .btn.btn-ghost.btn-error:focus,.dark .btn.btn-ghost.btn-error:hover{border-color:#e57373;color:#e57373}.dark .btn.btn-ghost.btn-warning:focus,.dark .btn.btn-ghost.btn-warning:hover{border-color:#ffb74d;color:#ffb74d}.dark .avatarholder,.dark .placeholder{background-color:transparent;border-color:#333}.dark .menu .menu-item{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .menu .menu-item.active,.dark .menu .menu-item:hover{color:#fff;border-color:#ccc}:root{--screen-size-small: 30em}@keyframes intro{0%{opacity:0}; 100%{opacity:1}}.blur-up{-webkit-filter:blur(5px);filter:blur(5px);transition:filter 400ms,-webkit-filter 400ms}.blur-up.lazyloaded{-webkit-filter:blur(0);filter:blur(0)}.hack .readmore{margin-bottom:2.2em}.responsive-iframe{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.responsive-iframe iframe{position:absolute;top:0;left:0;width:100%;height:100%}iframe{border:0}main,footer{animation:intro .3s both;animation-delay:.15s}footer time[datetime$=M]:before{content:"\2013\0020"}body>footer p.muted{margin-bottom:0}@media only screen and (max-width:30em){footer time[datetime$=M]{display:none}}blockquote cite{display:block}blockquote cite::before{content:"\2014\00A0"}:target{color:#fff}:disabled{cursor:not-allowed}#search-app [v-cloak]{display:none}.hack li ul{margin:0}.hack ol li{padding-left:27px}.main{padding:20px 10px}input.form-control{border-radius:0;background-color:#0000;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}input.form-control,textarea.form-control,select.form-control,.help-block{font-size:initial}@media only screen and (max-width:30em){.help-block{font-size:unset}}html{font-size:13px}.hack pre{font-size:17px}.hack .form input,.hack .form textarea,.hack .form button,.hack .form label{font-size:1rem}.hack .alert .highlight:first-of-type .chroma,.hack .card .highlight:first-of-type .chroma{margin-top:unset}.hack .alert .highlight:last-of-type .chroma,.hack .card .highlight:last-of-type .chroma{margin-bottom:unset}.hack figure{margin:unset}.hack figure a{border-bottom:none}.hack figure a:hover{background-color:inherit}article [itemprop=description]{margin-bottom:20px;margin-top:20px}article header img{width:100%;border-radius:3px}table td,table th{line-height:inherit}table a{border-bottom:unset}img{max-width:100%}@media screen and (min-width:768px){html{font-size:1em;margin-left:calc(100vw - 100%)}.container{max-width:50rem}}a[rel*="external"]::after {
  content: " " url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20class='i-external'%20viewBox='0%200%2032%2032'%20width='14'%20height='14'%20fill='none'%20stroke='%23ff9800'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='9.38%'%3E%3Cpath%20d='M14%209%20L3%209%203%2029%2023%2029%2023%2018%20M18%204%20L28%204%2028%2014%20M28%204%20L14%2018'/%3E%3C/svg%3E");
}
nav a.active {
  background-color: inherit;
  color: #fff;
}
a[itemprop="url"] {
  color: #ff9800;
}
a[itemprop="url"]:hover {
  color: #fff;
}
.muted, .help-block {
  opacity: 0.70;
}
.hack .muted,
.hack .help-block {
  color: #e0e0e0;
}
</style>
        


  
    <meta name="theme-color" content=#000>
  


      
    
  


    
    
  </head>
  
  
  
  <body class="hack dark main container">
    <header>
  
  <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
  <meta itemprop="name" content="Navigation Menu">
  
    
    <a itemprop="url"  href="/">Home</a>
    
    <a itemprop="url" class="active" href="/essay/">Essays</a>
    
    <a itemprop="url"  href="/note/">Notes</a>
    
    <a itemprop="url"  href="/quote/">Quotes</a>
    
    <a itemprop="url"  href="/talk/">Talks</a>
</nav>



</header>
    <main>
  <header>
    <h1>Fighting targeted backdoors with secure multiparty code reviews and a SSOT</h1>
  </header>
  <p>2018-10-06 [read as <a href="/essay/fighting-targeted-backdoors.txt">txt</a> or <a href="/essay/fighting-targeted-backdoors.pdf">PDF</a>]</p>

<h2 id="reflections-on-trusting-trust">Reflections on trusting trust</h2>

<blockquote>
<p>&ldquo;To what extend should one trust a statement that a program is free of
Trojan horses? Perhaps it is more important to trust the people <em>who
wrote the software</em>.&rdquo;</p>
</blockquote>

<p>(Ken Thompson, <a href="https://doi.org/10.1145/358198.358210">Turing Award Lecture</a>, 1984)</p>

<p>This famous statement leads to the following questions:</p>

<ul>
<li>How can we trust the people who wrote the software?</li>
<li>How can we make sure we actually run the code they wrote?</li>
</ul>

<h2 id="the-problem-of-targeted-backdoors">The problem of targeted backdoors</h2>

<p><a href="http://shadowlife.cc/files/hcpp17-smuggler.html">The Fog of Cryptowar</a> warns &ldquo;that the picture painted in [the] media
as well as by experts and pro-crypto activists, may be misleading and
creates the potential to engage a straw man put up by the executive
branches in various countries. This response risks that pro-crypto
forces miss the big picture of regulation in the communications sphere.&rdquo;</p>

<p>Crypto regulation is <strong>not</strong> black-and-white, the core of the debate is
not actually about outlawing crypto.</p>

<p>But often pro-crypto groups focus on such black-and-white scenarios with
bad counterarguments like &ldquo;banning cryptography is like banning math&rdquo;
which misses the point.</p>

<p>Increasing regulations in the cryptocurrency space are a good example
for the <strong>practical</strong> implications of regulations: Although the crypto
itself isn&rsquo;t outlawed, more and more KYC and AML regulations have huge
effects on the practical usability of cryptocurrencies, <strong>especially</strong>
for use cases where at least one of the transaction participants needs
financial privacy. What&rsquo;s the use of a cryptocurrency if you cannot
easily buy or sell it?</p>

<p>Todays widespread use of cryptography to encrypt personal communication
and data leads to the situation that the confiscation of computers and
smartphones no longer guarantees access to evidence that would stand up
in court:</p>

<blockquote>
<p>&ldquo;It is in light of cryptography providing effective limits to court
orders and warrants, and the history of previous regulation to make
law enforcement effective, that now regulation on cryptography is
demanded.</p>

<p>The main question remaining is if and how cryptography can be
regulated without causing too much collateral damage to the societal
uses of cryptography.</p>

<p>[&hellip;]</p>

<p>The goal is not, and cannot be, to snatch strong cryptography from the
hands of people. Instead, the current debate is about making the
secrets that cryptography protects accessible to law enforcement. This
is no minute point since it deeply shapes the approach that regulators
take, and it is therefor the point with which pro-crypto activists
must engage. Failing to see that the goal is access to the plaintext
confines arguments into a space that is neither relevant nor commonly
understandable for public opinion. While it is certainly difficult to
appreciate this difference from the perspective of cryptography it is
nevertheless substantial&mdash;because it allows for very different
technical implementations and legislative action.&rdquo;</p>
</blockquote>

<p>(from <a href="http://shadowlife.cc/files/hcpp17-smuggler.html">The Fog of Cryptowar</a>, section &ldquo;Motives for regulating
cryptography&rdquo;)</p>

<p>The article then goes on to argue that following five regulatory
approaches are both realistic and likely:</p>

<ol>
<li><p>Defense of metadata access.</p></li>

<li><p>Nudge vendors to deliver software with less secure default settings.</p></li>

<li><p>Lawful hacking.</p></li>

<li><p>Use of update mechanisms to deliver police Trojans.</p></li>

<li><p>Mandate plaintext access.</p></li>
</ol>

<p>In this paper we focus on <em>technical mitigations</em> to issue 4, the use of
<em>targeted updates</em> to introduce backdoors into specific devices in order
to surveil the user (so-called <em>targeted backdoors</em>).</p>

<p>The relevant suggestions in this regard were:</p>

<ol>
<li><p><strong>Secure software distribution</strong>: Automatically verify with some
form of single source of truth (SSOT) that a program delivered to a
devices is the same as the installation on all other devices.</p></li>

<li><p><strong>Secure software development</strong>: Better review and auditing
processes for security critical code. Most importantly, enforce that
code changes <em>always</em> require the cryptographic signatures of <em>at
least two</em> developers.</p></li>

<li><p><strong>Verifiable build processes</strong>: Review and audits are of little use,
if the build process (the compilation) cannot be verified. This
means that verifiable, deterministic builds should become
commonplace.</p></li>

<li><p><strong>More decentralized platform vendors</strong>: Today most users depend on
very few platform providers that control both the operating system
and the application delivery channels, which allows regulators to
capture wide sections of the market by focussing all attention on a
handful of corporations in a few jurisdictions.</p></li>
</ol>

<p>The technical mitigations to targeted updates discussed in this article
concern suggestions 1 to 3. Suggestion 4 is more non-technical in nature
and is discussed in the conclusion at the end.</p>

<h2 id="recent-developments-regarding-targeted-backdoors">Recent developments regarding targeted backdoors</h2>

<p>Unfortunately, <em>targeted updates</em> is exactly the approach the Australian
government, a member of the Five Eyes, is taking in their proposed
Assistance and Access Bill 2018:</p>

<blockquote>
<p>&ldquo;[Technical Capability] Notices may still require a provider to
enable access to a particular service, particular device or particular
item of software, which would not systemically weaken these products
across the market. For example, if an agency were undertaking an
investigation into an act of terrorism and a <strong>provider was capable</strong>
of <strong>removing encryption from the device of a terrorism suspect
without weakening other devices in the market</strong> then the provider
could be compelled under a technical assistance notice to provide help
to the agency by removing the electronic protection.</p>

<p>The mere fact that a capability to selectively assist agencies with
access to a target device exists will not necessarily mean that a
systemic weakness has been built. The nature and scope of any
weaknesses and vulnerabilities will turn on the circumstances in
question and the degree to which malicious actors are able to exploit
the changes required.</p>

<p>Likewise, a notice may require a provider to <strong>facilitate access to
information prior to or after an encryption method is employed</strong>, as
this does not weaken the encryption itself. A requirement to disclose
an existing vulnerability is also not prohibited.&rdquo;</p>
</blockquote>

<p>(from the <a href="http://frankbraun.org/ref/assistance-and-access-bill-2018-explanatory-document.pdf">Assistance and Access Bill 2018, Explanatory Document</a>,
August 2018, page 47, highlighting added)</p>

<p>If one looks behind the general formulations used in the explanatory
document, it becomes clear that <em>targeted updates</em> are the concrete
technical methods available today [&ldquo;provider was capable&rdquo;] which
allows service providers to give governments these <em>targeted backdoors</em>.</p>

<p>These targeted updates would either work on the application level or the
operating system level:</p>

<ul>
<li><p>A targeted update to a secure messaging application could introduce
a backdoor for specific application and user combination,
effectively &ldquo;removing encryption from the device of a terrorism
suspect without weakening other devices in the market&rdquo;.</p></li>

<li><p>Likewise, a targeted update to an operating system could introduce a
backdoor to this specific operating system and user combination and
thereby &ldquo;facilitate access to information prior to or after an
encryption method is employed&rdquo;.</p></li>
</ul>

<p>The motivation the Department of Home Affairs of the Australian
Government gives for the Assistance and Access Bill 2018 is quite
instructive:</p>

<blockquote>
<p>&ldquo;Encryption conceals the content of communications and data held on
devices, as well as the identity of users. Secure, encrypted
communications are increasingly being used by terrorist groups and
organised criminals to avoid detection and disruption. The problem is
widespread, for example:</p>

<ul>
<li>Encryption impacts at least nine out of every ten of ASIO’s
[Australian Security Intelligence Organisation] priority cases.</li>
<li>Over 90 per cent of data being lawfully intercepd by the AFP
[Australian Federal Police] now use some form of encryption.</li>
<li>Effectively all communications among terrorists and organised
crime groups are expected to be encrypted by 2020.</li>
</ul>

<p>State and Territory law enforcement are facing significant challenges
as well. The following example from Victoria Police demonstrates:</p>

<p><em>A high risk Registered Sex Offender (RSO) was placed on the register
for raping a 16 year old female, served nine years imprisonment and is
now monitored by Corrections via two ankle bracelets whilst out on
parole. Victoria Police received intelligence that he was breaching
his RSO and parole conditions by contacting a number of females
typically between 13 and 17 years of age. Enquiries showed that he was
contacting these females and offering them drugs in return for sexual
favours. The suspect was arrested and his mobile phone was seized but
despite legislative requirements he refused to provide his passcode.
Due to an inability to access his phone as well as the fact that he
<strong>used encrypted communication methods such as Snapchat and Facebook
Messenger [sic]</strong>, Victoria Police was unable to access evidence
which would have enabled them to secure a successful prosecution and
identify further victims and offences. These are high victim impact
crimes that are being hindered by the inability of law enforcement to
access encrypted communications.</em></p>

<p>Obstacles to the lawful access of communications significantly impacts
the ability of law enforcement and security agencies to enforce the
law, investigate serious crimes and protect the public. The measures
in the Assistance and Access Bill will help our agencies overcome
these challenges.&rdquo;</p>
</blockquote>

<p>(from <a href="https://www.homeaffairs.gov.au/about/consultations/assistance-and-access-bill-2018">The Assistance and Access Bill 2018 website</a>, accessed on
2018-10-04)</p>

<p>This approach to targeted backdoors won&rsquo;t be unique to Australia, they
are just spearheading the approach for the Five Eye nations, and others
are likely to follow.</p>

<p>This document describes an approach to fight targeted backdoors with
secure multiparty code reviews and a single source of truth (SSOT). This
approach would render service providers <strong>incapable</strong> to comply with
requests as described above, because it would ensure in an
uncircumventable way that <strong>all</strong> users <strong>always</strong> get the same software
update.</p>

<h2 id="current-mitigation-attempts">Current mitigation attempts</h2>

<p>We now describe some of the currently deployed software signing methods.</p>

<h3 id="signing-software-with-secure-apt-debian-packages">Signing software with secure APT (Debian) packages</h3>

<p>This is the model employed by <code>apt</code> in Debian and related distributions:</p>

<blockquote>
<p>&ldquo;By adding a key to <code>apt</code>&rsquo;s keyring, you&rsquo;re telling <code>apt</code> to trust
everything signed by the key, and this lets you know for sure that apt
won&rsquo;t install anything not <em>signed by the person who possesses the
private key</em>.&rdquo;</p>
</blockquote>

<p>(from <a href="https://wiki.debian.org/SecureApt">SecureApt</a>)</p>

<p>This leads to the reverse conclusion, that <code>apt</code> trusts everything
signed by the person&rsquo;s private key.</p>

<p><code>dpkg</code> has support for verifying GPG signatures of Debian package files,
but this verification is disabled by default, only repository metadata
is verified:</p>

<blockquote>
<p>GPG can be used to create a digital signature for both Debian package
files and for APT repository metadata.</p>

<p>Many Debian-based Linux distributions (e.g., Ubuntu) have GPG
signature verification of Debian package files (.deb) disabled by
default and instead choose to verify GPG signatures of repository
metadata and source packages (.dsc). The setting which enables GPG
signature checking of the individual .deb packages can be found in
<code>/etc/dpkg/dpkg.cfg</code> and is set to <code>no-debsig</code>, but there are
important caveats to enabling this option explained below.</p>

<p>Further, most official Debian package files from the publicly
accessible repositories <em>do not have</em> GPG signatures. The official
repository metadata is GPG signed, as are the source packages, but the
<code>.deb</code> packages themselves are not.</p>

<p>If you publish a Debian package and GPG sign the package yourself
before distributing it to users, those users’ systems will, in most
cases, t verify the signature of the package unless they have done a
considerable amount of configuration. However, their system will, in
most cases, automatically verify repository metadata.</p>
</blockquote>

<p>(from HOWTO <a href="https://blog.packagecloud.io/eng/2014/10/28/howto-gpg-sign-verify-deb-packages-apt-repositories/">GPG sign and verify deb packages</a> and APT repositories)</p>

<p>Let&rsquo;s verify this on a fresh Ubuntu 18.04 x64 server instance (on
<a href="https://www.digitalocean.com/">DigitalOcean</a>):</p>

<pre><code>root@Ubuntu:~# cat /etc/dpkg/dpkg.cfg
# dpkg configuration file
#
# This file can contain default options for dpkg.  All command-line
# options are allowed.  Values can be specified by putting them after
# the option, separated by whitespace and/or an `=' sign.
#

# Do not enable debsig-verify by default; since the distribution is not using
# embedded signatures, debsig-verify would reject all packages.
no-debsig

# Log status changes and actions to a file.
log /var/log/dpkg.log
</code></pre>

<p>And on a fresh Debian 9.5 x64 server instance (also on DigitalOcean):</p>

<pre><code>root@Debian:~# cat /etc/dpkg/dpkg.cfg
# dpkg configuration file
#
# This file can contain default options for dpkg.  All command-line
# options are allowed.  Values can be specified by putting them after
# the option, separated by whitespace and/or an `=' sign.
#

# Do not enable debsig-verify by default; since the distribution is not using
# embedded signatures, debsig-verify would reject all packages.
no-debsig

# Log status changes and actions to a file.
log /var/log/dpkg.log
</code></pre>

<p>So there is indeed no package signing in Debian, only repository
metadata signing with GPG.</p>

<h4 id="gpg-keys">GPG keys</h4>

<p>Let&rsquo;s look at the GPG keys trusted for repository metadata signing.</p>

<p>On Ubuntu 18.04 x64:</p>

<pre><code>root@Ubuntu:~# apt-key list
/etc/apt/trusted.gpg.d/ubuntu-keyring-2012-archive.gpg
------------------------------------------------------
pub   rsa4096 2012-05-11 [SC]
      790B C727 7767 219C 42C8  6F93 3B4F E6AC C0B2 1F32
uid           [ unknown] Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;

/etc/apt/trusted.gpg.d/ubuntu-keyring-2012-cdimage.gpg
------------------------------------------------------
pub   rsa4096 2012-05-11 [SC]
      8439 38DF 228D 22F7 B374  2BC0 D94A A3F0 EFE2 1092
uid           [ unknown] Ubuntu CD Image Automatic Signing Key (2012) &lt;cdimage@ubuntu.com&gt;
</code></pre>

<p>On Debian 9.5 x64:</p>

<pre><code>root@Debian:~# apt-key list
/etc/apt/trusted.gpg.d/debian-archive-jessie-automatic.gpg
----------------------------------------------------------
pub   rsa4096 2014-11-21 [SC] [expires: 2022-11-19]
      126C 0D24 BD8A 2942 CC7D  F8AC 7638 D044 2B90 D010
uid           [ unknown] Debian Archive Automatic Signing Key (8/jessie) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-jessie-security-automatic.gpg
-------------------------------------------------------------------
pub   rsa4096 2014-11-21 [SC] [expires: 2022-11-19]
      D211 6914 1CEC D440 F2EB  8DDA 9D6D 8F6B C857 C906
uid           [ unknown] Debian Security Archive Automatic Signing Key (8/jessie) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-jessie-stable.gpg
-------------------------------------------------------
pub   rsa4096 2013-08-17 [SC] [expires: 2021-08-15]
      75DD C3C4 A499 F1A1 8CB5  F3C8 CBF8 D6FD 518E 17E1
uid           [ unknown] Jessie Stable Release Key &lt;debian-release@lists.debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-stretch-automatic.gpg
-----------------------------------------------------------
pub   rsa4096 2017-05-22 [SC] [expires: 2025-05-20]
      E1CF 20DD FFE4 B89E 8026  58F1 E0B1 1894 F66A EC98
uid           [ unknown] Debian Archive Automatic Signing Key (9/stretch) &lt;ftpmaster@debian.org&gt;
sub   rsa4096 2017-05-22 [S] [expires: 2025-05-20]

/etc/apt/trusted.gpg.d/debian-archive-stretch-security-automatic.gpg
--------------------------------------------------------------------
pub   rsa4096 2017-05-22 [SC] [expires: 2025-05-20]
      6ED6 F5CB 5FA6 FB2F 460A  E88E EDA0 D238 8AE2 2BA9
uid           [ unknown] Debian Security Archive Automatic Signing Key (9/stretch) &lt;ftpmaster@debian.org&gt;
sub   rsa4096 2017-05-22 [S] [expires: 2025-05-20]

/etc/apt/trusted.gpg.d/debian-archive-stretch-stable.gpg
--------------------------------------------------------
pub   rsa4096 2017-05-20 [SC] [expires: 2025-05-18]
      067E 3C45 6BAE 240A CEE8  8F6F EF0F 382A 1A7B 6500
uid           [ unknown] Debian Stable Release Key (9/stretch) &lt;debian-release@lists.debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-wheezy-automatic.gpg
----------------------------------------------------------
pub   rsa4096 2012-04-27 [SC] [expires: 2020-04-25]
      A1BD 8E9D 78F7 FE5C 3E65  D8AF 8B48 AD62 4692 5553
uid           [ unknown] Debian Archive Automatic Signing Key (7.0/wheezy) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-wheezy-stable.gpg
-------------------------------------------------------
pub   rsa4096 2012-05-08 [SC] [expires: 2019-05-07]
      ED6D 6527 1AAC F0FF 15D1  2303 6FB2 A1C2 65FF B764
uid           [ unknown] Wheezy Stable Release Key &lt;debian-release@lists.debian.org&gt;
</code></pre>

<p>These keys are up to 6 years old and their possession is the only thing
that is necessary to get clients to install updates.</p>

<h4 id="problems-with-this-approach">Problems with this approach</h4>

<p>In my opinion, the approach taken by APT has the following problems:</p>

<ul>
<li>Developer signatures do not matter for the end-user, only repository
signatures.</li>
<li>Repository signatures are created by a single GPG key which is often
quite old and kept on a networked server, which seems to be the
default method of running Debian repositories with <a href="https://wiki.debian.org/DebianRepository/SetupWithReprepro">Reprepro</a>. That
means:

<ul>
<li>There is a single point of failure (just one key).</li>
<li>If keys are kept on a networked server they are easier to steal.</li>
<li>The long validity times make stolen keys more disastrous.</li>
<li>If the signing of packages is automatic then it is likely that
there is little checking of package content happening.</li>
</ul></li>
<li>It doesn&rsquo;t contain a method for key rotation, in order to rotate
keys packages are usually signed with &ldquo;overlapping&rdquo; keys for a
while. This makes it hard to rotate keys in an emergency.</li>
<li>It seems that packages have to be signed only by one trusted key in
order to be accepted by an <code>apt</code> client. That is, there seems to be
no pinned mapping between repositories and GPG keys. However, due to
time constraints I wasn&rsquo;t able to verify this suspicion, please
<a href="mailto:frank@cryptogroup.net">contact</a> me if you have more detailed information.</li>
</ul>

<h3 id="signing-software-with-signify-in-openbsd">Signing software with signify in OpenBSD</h3>

<p><a href="https://openbsd.org/">OpenBSD</a> has one of the best deployed solutions for <a href="https://www.openbsd.org/papers/bsdcan-signify.html">Securing OpenBSD
From Us To You</a>.</p>

<p>They implemented a simple minimal tool called <code>signify</code> to create and
verify Ed25519 signatures and employed it to protect their base and
package system. Keys are rotated with every release by putting the
public keys for the next release in the current release.</p>

<p>Their simple setup and short keys makes it easy to verify the
authenticity of keys, but they still suffer from most of the possible
attacks described further below.</p>

<h3 id="signing-software-with-the-git-version-control-system">Signing software with the Git version control system</h3>

<p>Git guarantees data integrity via Git&rsquo;s data structure (Merkle trees)
and it allows to sign <em>tags</em> and <em>commits</em> with GPG.</p>

<h4 id="signing-tags">Signing tags</h4>

<p>The signing and verifying of tags in Git works as follows:</p>

<pre><code>$ git tag -s v1.5 -m 'my signed 1.5 tag'
$ git tag -v v1.5
</code></pre>

<p>The problem with signing tags is that they are not unmodifiable.</p>

<h4 id="signing-commits">Signing commits</h4>

<p>The signing and verifying of commits in Git works as follows:</p>

<pre><code>$ git commit -a -S -m 'signed commit'
$ git merge --verify-signatures signed-branch
</code></pre>

<p>Only merging &ldquo;fast-forwarding&rdquo; branches gives some protection against
regression (given one knows the <code>HEAD</code>).</p>

<p>The problem with signing commits is that <em>every</em> commit needs to be
signed and the user has to trust <em>all</em> developer keys, which makes it
hard to deploy in practice. And even then this model has no way of
enforcing that at least two or more developer sign each commit, allowing
a single developer or compromised key to introduce backdoors.</p>

<h3 id="summary-of-possible-attacks">Summary of possible attacks</h3>

<p>The current solutions to sign software described above do not protect
against the following possible attacks:</p>

<ul>
<li>Key compromise.</li>
<li>Developer coercion (wrench attack), blackmailing, or bribing.</li>
<li>Regression (suppression of updates).</li>
</ul>

<p>A developer being forced to give up his signing key or a stolen
repository signing key would be disastrous. Furthermore, GPG has no
automatic mechanism for key rotation which is a likely reason why many
GPG signing keys are quite old.</p>

<h2 id="a-proposed-solution">A proposed solution</h2>

<p>We propose a design for <em>secure software distribution</em> and <em>secure
software development</em> which mitigates the aforementioned possible
attacks. In our implementation we get also get <em>verifiable build
processes</em> for free, because the client compiles the source code himself
and the source itself if fully secured. With a language that allows
reproducible builds (like Go) this allows a verifiable build process.</p>

<p>The design tackles these to areas by:</p>

<ol>
<li><p>Establishing code trust via multi-party code reviews recorded in
unmodifiable hash chains. This prevents that a single developer can
include a generic backdoor into software.</p></li>

<li><p>A single source of truth (SSOT) mechanism which makes sure every
user of the software gets the same version of the software. This
prevents targeted backdoors and the suppression of security updates.</p></li>
</ol>

<p>Together this builds a secure software delivery and update mechanism
which cannot be compromised by a single developer or for a specific
user, thereby preventing <em>targeted backdoors</em>.</p>

<p>Below we describe the proposed design in more detail.</p>

<h3 id="code-trust-via-multi-party-code-reviews-recorded-in-hash-chains">Code trust via multi-party code reviews recorded in hash chains</h3>

<p>The general design looks like follows:</p>

<ul>
<li><p>The &ldquo;unit&rdquo; of code are directory trees.</p></li>

<li><p>The hash of a directory tree is a <em>tree hash</em>.</p></li>

<li><p>The <em>code history</em> is a sequence of <em>unique</em> tree hashes, starting
from the hash of the empty tree.</p></li>

<li><p>The sequence of tree hashes and <em>signatures</em> over them are recorded
in a <em>hash chain</em> file.</p></li>

<li><p>The signatures contributes towards a m-of-n threshold.</p></li>

<li><p>Code is distributed as a set of patch files which transform a
directory tree with hash <strong>a</strong> into a directory tree with hash
<strong>b</strong>.</p></li>

<li><p>Patch files are named after the outgoing tree hash <strong>a</strong>.</p></li>
</ul>

<h3 id="tree-hash-specification">Tree hash specification</h3>

<p>To calculate the hash of a directory tree (a <em>tree hash</em>) a list of all
files in the directory root (a <em>tree list</em>) is created as follows.</p>

<p>All the files below the root of the directory tree are traversed in
lexical order and printed in this format:</p>

<pre><code>m xxx filename
</code></pre>

<p>Where:</p>

<pre><code>m        is the mode ('f' or 'x')
xxx      is the SHA256 hash for the file in hex notation
filename is the file name with directory prefix starting at root
</code></pre>

<p>Example list:</p>

<pre><code>f 7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730 bar/baz.txt
x b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c foo.txt
</code></pre>

<p>The fields are separated with single white space characters and the
lines are separated with single newline characters.</p>

<p>Directories are only implicitly listed (i.e., if they contain files).
Entries start with &lsquo;f&rsquo; if it is a regular file (read and write
permission for user) and with &lsquo;x&rsquo; if it is an executable (read, write,
and executable for user).</p>

<p>The directory tree must only contain directories, regular files, or
executables.</p>

<p>The deterministic tree list serves as the basis for a hash of a
directory tree (the tree hash), which is the SHA256 hash of the tree
list in hex notation.</p>

<h3 id="hash-chain-file-format">Hash chain file format</h3>

<p>A hash chain is a chain of signatures over a chain of code changes.</p>

<p>A hash chain is stored in a simple newline separated text file where
each hash chain entry corresponds to a single line and has the following
form:</p>

<pre><code>hash-of-previous current-time type type-fields ...
</code></pre>

<p>Where hash-of-previous is the SHA256 hash of the previous line (without
the trailing newline) in hex encoding. The fields are separated by
single white spaces. The current-time is encoded as an ISO 8601 string
in UTC.</p>

<p>All hashes in a hash chain are SHA256 hashes encoded in hex notation.
Hex encodings have to be lowercase. All public keys are Ed25519 keys and
they and their signatures are encoded in base64 (URL encoding without
padding). Comments are arbitrary UTF-8 sequences, but cannot contain
newlines.</p>

<p>There are six different types of hash chain entries:</p>

<pre><code>cstart
source
signtr
addkey
remkey
sigctl
</code></pre>

<p>A hash chain must start with a cstart entry and that is the only line
where this type must appear.</p>

<h4 id="type-cstart">Type cstart</h4>

<p>A cstart entry starts a new hash chain.</p>

<pre><code>hash-of-previous current-time cstart pubkey nonce signature [comment]
</code></pre>

<p>The hash-of-previous for the cstart time is the hash of an empty source
tree. The signature by pubkey is over the pubkey, the nonce, and the
optional comment. The comment should identify the owner of the pubkey,
not the project. The nonce must be a 24 byte random number in base64
(URL encoding without padding). This makes pubkey the only valid signer
for the hash chain and implicitly sets the signature threshold m to 1.</p>

<h4 id="type-source">Type source</h4>

<p>A source entry marks a new source tree state for publication from the
developer owning the signing pubkey. The optional comment can be used to
describe the change to the reviewers.</p>

<pre><code>hash-of-previous current-time source tree-hash pubkey signature [comment]
</code></pre>

<p>The signature by pubkey is over the source tree hash and the optional
comment. See the tree package for a detailed description of source tree
hashes.</p>

<h4 id="type-signtr">Type signtr</h4>

<p>A signtr entry signs a previous hash chain entry and thereby approves
all code changes and changes to the set of signature keys and m up to
that point.</p>

<pre><code>hash-of-previous current-time signtr hash-of-chain-entry pubkey signature
</code></pre>

<p>It does not necessarily sign the previous line and can therefore be done
in a detached fashion by a reviewer and added later by the developer
responsible for maintaining the hash chain. This avoids merge conflicts.</p>

<h4 id="type-addkey">Type addkey</h4>

<p>An addkey entry marks a signature pubkey for addition to the list of
approved signature keys.</p>

<pre><code>hash-of-previous current-time addkey w pubkey signature [comment]
</code></pre>

<p>The weight of the key towards the minimum number of necessary signatures
m is denoted by w. The pubkey can be accompanied by an optional comment,
but the signature must be over both. The comment is added last so it can
contain white spaces without complicating the parsing, it should
identify the owner of the pubkey.</p>

<h4 id="type-remkey">Type remkey</h4>

<p>A remkey entry marks a signature pubkey for removal from the list of
approved signature keys.</p>

<pre><code>hash-of-previous current-time remkey pubkey
</code></pre>

<h4 id="type-sigctl">Type sigctl</h4>

<p>A sigctl entry denotes an update of m, the minimum number of necessary
signatures to approve state changes (the threshold).</p>

<pre><code>hash-of-previous current-time sigctl m
</code></pre>

<h3 id="patchfile-format">Patchfile format</h3>

<p>A patchfile is a UTF-8 encoded file split into newline separated lines.
It starts with the following line which defines the patchfile version:</p>

<pre><code>codechain patchfile version 1
</code></pre>

<p>The second line gives the tree hash of the directory tree the patchfile
applies to (example):</p>

<pre><code>treehash 5998c63aca42e471297c0fa353538a93d4d4cfafe9a672df6989e694188b4a92
</code></pre>

<p>The main body of the patch file encodes file deletions, file additions,
and file diffs. A file deletion is encoded as follows (example):</p>

<pre><code>- f 927d2cae58bb53cdd087bb7178afeff9dab8ec1691cbd01aeccae62559da2791 gopher.png
</code></pre>

<p>The &lsquo;-&rsquo; denotes a deletion. The other three entries are the same as file
entries of tree lists.</p>

<p>A file addition is encoded as follows (example):</p>

<pre><code>+ f ad125cc5c1fb680be130908a0838ca2235db04285bcdd29e8e25087927e7dd0d hello.go
</code></pre>

<p>The &lsquo;+&rsquo; denotes an addition. The other three entries are the same as
file entries of tree lists.</p>

<p>After an addition the actual patch must follow, either in &ldquo;dmppatch&rdquo;
(for UTF-8 files) or in &ldquo;ascii85&rdquo; format (for binary files). The
&ldquo;dmppatch&rdquo; file format looks like the following (example):</p>

<pre><code>dmppatch 2
@@ -0,0 +1,78 @@
+package main%0A%0Aimport (%0A%09%22fmt%22%0A)%0A%0Afunc main() %7B%0A%09fmt.Println(%22hello world!%22)%0A%7D%0A
</code></pre>

<p>The number after &ldquo;dmppatch&rdquo; denotes the number of lines following
containing the actual UTF-8 patch.</p>

<p>The &ldquo;ascii85&rdquo; file format looks like the following (example):</p>

<pre><code>ascii85 2
+,^C)8Mp-E!!DW60b/e#'ElcGar]O1ZH.;&gt;ZnWJO:iLd/`5G7uXPR`iQmq0B\]npD=)8AK4gPQFI-+W_
&gt;oidmeIj`.fgNufo&lt;4MB5*&amp;XfkqnCOo9\::*WQ0?z!!*#^!R=9-%KImW!!
</code></pre>

<p>The number after &ldquo;ascii85&rdquo; denotes the number of lines following
containing the actual binary encoding. &ldquo;ascii85&rdquo; patches are not real
patches, but always encode the entire binary file.</p>

<p>A file diff is encoded as follows (example):</p>

<pre><code>- f ad125cc5c1fb680be130908a0838ca2235db04285bcdd29e8e25087927e7dd0d hello.go
+ f 1b239e494fa201667627de82f0e4dc27b7b00b6ec06146e4d062730bf3762141 hello.go
</code></pre>

<p>As with file additions, after a file diff the actual patch must follow,
either in &ldquo;dmppatch&rdquo; or &ldquo;ascii85&rdquo; format (see above), if the file hash
changed. That is, if just the file mode changed and the file hash stayed
the same no patch must follow.</p>

<p>File diffs are only used if the file names (&ldquo;hello.go&rdquo; in the example
above) are the same. File moves are implemented as a file deletion and a
file addition.</p>

<p>The last line in a patchfile must be the tree hash of the directory tree
after the patchfile has been applied (example):</p>

<pre><code>treehash e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
</code></pre>

<p>Patchfiles are optimized for robustness, not for compactness or human
readability (although the human readability is reasonable). A complete
example containing a single UTF-8 file addition:</p>

<pre><code>codechain patchfile version 1
treehash e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
+ f ad125cc5c1fb680be130908a0838ca2235db04285bcdd29e8e25087927e7dd0d hello.go
dmppatch 2
@@ -0,0 +1,78 @@
+package main%0A%0Aimport (%0A%09%22fmt%22%0A)%0A%0Afunc main() %7B%0A%09fmt.Println(%22hello world!%22)%0A%7D%0A
treehash 5998c63aca42e471297c0fa353538a93d4d4cfafe9a672df6989e694188b4a92
</code></pre>

<h4 id="diff-function-specification">Diff function specification</h4>

<p>Given the patchfile format described above, a Diff function that
computes a patch file for two directory trees rooted at A and B is
straightforward to implement:</p>

<ol>
<li><p>Calculate tree lists LIST_A and LIST_B (in lexical order) for A
and B.</p></li>

<li><p>Compare the file names NAME_A and NAME_B (lexicographically) of
the first two entries in LIST_A and LIST_B:</p>

<ul>
<li>If NAME_A &lt; NAME_B: File delete NAME_A, remove it from
LIST_A, goto 2.</li>
<li>If NAME_A &gt; NAME_B: File add NAME_B, remove it from
LIST_B, goto 2.</li>
<li>If NAME_A == NAME_B:</li>
<li>If file mode or file hash of files NAME_A and NAME_B differ:
file diff.</li>
<li>Remove NAME_A from LIST_A, NAME_B from LIST_B, and goto 2.</li>
</ul></li>

<li><p>If LIST_A still contains entries while LIST_B is empty, add file
deletions for all entries in LIST_A.</p></li>

<li><p>If LIST_B still contains entries while LIST_A is empty, add file
additions for all entries in LIST_B.</p></li>
</ol>

<h4 id="apply-function-specification">Apply function specification</h4>

<p>To apply a patchfile PATCH to a directory DIR we use the following
algorithm:</p>

<ol>
<li><p>Read first line of of PATCH and make sure it contains a codechain
patchfile version we understand.</p></li>

<li><p>Read the second line of PATCH, make sure it is a treehash, and
compare it with the treehash of DIR (before any patches have been
applied).</p></li>

<li><p>Read next line of PATCH:</p>

<ul>
<li>If it starts with &lsquo;+&rsquo;: Add file encoded in the following patch.</li>
<li>If it starts with &lsquo;-&rsquo;:</li>
<li>If the next line starts with &lsquo;+&rsquo;:

<ul>
<li>If the file name differ: Delete first file, add second file
(with the following patch, which must be either ascii85 or
dmppatch).</li>
<li>Otherwise (file names are the same):</li>
<li>If hashes are the same (only file modes differ): Adjust
mode.</li>
<li>Otherwise (hashes differ): Apply the following patch, which
must be either ascii85 or dmppatch (and adjust mode, if
necessary).</li>
</ul></li>
<li>Otherwise: Delete file.</li>
<li>If it starts with &lsquo;treehash&rsquo;: Goto 4.</li>
<li>Goto 3.</li>
</ul></li>

<li><p>Read the last line of PATCH, make sure it is a treehash, and compare
it with the treehash of DIR (after all patches have been applied).</p></li>
</ol>

<h3 id="distributing-the-current-head">Distributing the current head</h3>

<p>The current head of a hash chain is all one need to fully verify the
entire code history and recreate the most current code version with
enough signatures, given that one has access to the hash chain and the
corresponding patch files.</p>

<p>But in order to prevent the suppression of updates to certain users, a
form of targeted updates, one has to ensure that all users have access
to the most current head.</p>

<p>The method to do that is employing a so-called single source of truth
(SSOT) where every user has access to the same authentic version of a
data object. See also <a href="https://en.wikipedia.org/wiki/Single_source_of_truth">SSOT on Wikipedia</a>.</p>

<h3 id="single-source-of-truth-ssot-via-dns">Single source of truth (SSOT) via DNS</h3>

<p>One widely deployed SSOT system which can be used for that is the Domain
Name System (DNS) which associates various information with domain names
assigned to each of the participating entities (see <a href="https://en.wikipedia.org/wiki/Domain_Name_System">DNS on Wikipedia</a>).</p>

<p>In our design we store the necessary information, a <em>signed head</em>, in
the <a href="https://en.wikipedia.org/wiki/TXT_record">TXT record</a> of a fully qualified domain name (<a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">FQDN</a>) starting with
the prefix <code>_codechain.</code></p>

<p>The head is signed, which allows clients to verify updates to it, after
they have seen it for the first time and learning the corresponding
public key (trust on first use).</p>

<p>Due to the distributed caching design of DNS it is not possible for
publishers to send different signed heads to different users, which
prevents <em>targeted updates</em> by publishers.</p>

<p>Distributing false signed heads through <a href="https://en.wikipedia.org/wiki/DNS_spoofing">DNS spoofing</a> is prevented <strong>if
and only if</strong> the client has seen a signed head before (clients cache
public keys)</p>

<p>If a client has not seen a valid head before it is vulnerable to DNS
spoofing. However, this can be mitigated by deploying the SSOT on a
domain which is secured by the Domain Name System Security Extensions
(<a href="https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions">DNSSEC</a>).</p>

<p>In order to publish packages using a single source of truth (SSOT) with
DNS TXT records we first define how the <em>signed heads</em> are represented
as TXT records and then define two noperations: &ldquo;CreatePkg&rdquo; to initially
publish a package and &ldquo;SignHead&rdquo; to publish updates.</p>

<h4 id="signed-head-specification">Signed head specification</h4>

<p>Signed heads have the following fields:</p>

<ul>
<li><code>PUBKEY</code> (32-byte), the Ed25519 public key of SSOT head signer.</li>
<li><code>PUBKEY_ROTATE</code> (32-byte), Ed25519 pubkey to rotate to, set to 0 if
unused.</li>
<li><code>VALID_FROM</code> (8-byte), the signed head is valid from the given Unix
time.</li>
<li><code>VALID_TO</code> (8-byte), the signed head is valid to the given Unix
time.</li>
<li><code>COUNTER</code> (8-byte), strictly increasing signature counter.</li>
<li><code>HEAD</code>, the Codechain head to sign.</li>
<li><code>SIGNATURE</code>, signature with <code>PUBKEY</code>.</li>
</ul>

<p>The <code>SIGNATURE</code> is over all previous fields:</p>

<p><code>PUBKEY|PUBKEY_ROTATE|VALID_FROM|VALID_TO|COUNTER|HEAD</code></p>

<p>The signed head is a concatenation of</p>

<p><code>PUBKEY|PUBKEY_ROTATE|VALID_FROM|VALID_TO|COUNTER|HEAD|SIGNATURE</code></p>

<p>encoded in base64 (URL encoding without padding.</p>

<p>All integers (<code>VALID_FROM</code>, <code>VALID_TO</code>, <code>COUNTER</code>) are encoded in
network order (big-endian).</p>

<h4 id="createpkg-specification">CreatePkg specification</h4>

<p>To create a new secure package for a project developed with Codechain
that should be distributed with a SSOT using DNS TXT records, the
following procedure is defined:</p>

<ol>
<li><p>Make sure the project with NAME has not been published before. That
is, the directory <code>~/.config/ssotpub/pkgs/NAME</code> does not exist.</p></li>

<li><p>Create a new <code>.secpkg</code> file which specifies the following:</p>

<ul>
<li>The NAME of the project.</li>
<li>The fully qualified domain name (DNS) where the TXT records can
be queried.</li>
<li>The URL under which the distribution .tar.gz files can be
downloaded.</li>
<li>The current HEAD of the project&rsquo;s Codechain.</li>
</ul>

<p>The .secpkg file is saved to the current working directory, which is
typically added to the root of the project&rsquo;s repository.</p></li>

<li><p>Create the first signed head for the current project&rsquo;s HEAD with a
supplied secret key and counter set to 0.</p></li>

<li><p>Create the directory <code>~/.config/ssotpub/pkgs/NAME/dists</code> and save
the current distribution to
<code>~/.config/ssotpub/pkgs/NAME/dists/HEAD.tar.gz</code>
(<code>codechain createdist</code>).</p></li>

<li><p>Save the signed head to <code>~/.config/ssotpub/pkgs/NAME/signed_head</code></p></li>

<li><p>Print the distribution name:<br />
<code>~/.config/secpkg/pkgs/NAME/dists/HEAD.tar.gz</code></p></li>

<li><p>Print DNS TXT record as defined by the .secpkg and the first signed
head.</p></li>
</ol>

<p>Afterwards the administrator manually uploads the distribution
HEAD.tar.gz to the download URL and publishes the new DNS TXT record in
the defined zone. DNSSEC should be enabled.</p>

<h4 id="signhead-specification">SignHead specification</h4>

<p>To publish an update of a secure package with SSOT do the following:</p>

<ol>
<li><p>Parse the .secpkg file in the current working directory.</p></li>

<li><p>Make sure the project with NAME has been published before. That is,
the directory <code>~/.config/ssotpub/pkgs/NAME</code> exists.</p></li>

<li><p>Validate the signed head in
<code>~/.config/ssotpub/pkgs/NAME/signed_head</code> and make sure the
corresponding secret key is available.</p></li>

<li><p>Get the HEAD from <code>.codechain/hashchain</code> in the current working
directory.</p></li>

<li><p>Create a new signed head with current HEAD, the counter of the
previous signed head plus 1, and update the saved signed head:</p>

<ul>
<li>Copy <code>~/.config/ssotpub/pkgs/NAME/signed_head</code> to<br />
<code>~/.config/ssotpub/pkgs/NAME/previous_signed_head</code></li>
<li>Save new signed head to<br />
<code>~/.config/ssotpub/pkgs/NAME/signed_head</code> (atomic).</li>
</ul></li>

<li><p>Save the current distribution to:<br />
<code>~/.config/secpkg/pkgs/NAME/dists/HEAD.tar.gz</code><br />
(<code>codechain createdist</code>).</p></li>

<li><p>Print the distribution name:<br />
<code>~/.config/ssotpkg/pkgs/NAME/dists/HEAD.tar.gz</code></p></li>

<li><p>Print DNS TXT record as defined by the <code>.secpkg</code> and the signed
head.</p></li>

<li><p>If the HEAD changed, update the <code>.secpkg</code> file accordingly.</p></li>
</ol>

<p>Afterwards the administrator manually uploads the distribution
HEAD.tar.gz to the download URL and publishes the new DNS TXT record in
the defined zone. DNSSEC should be enabled.</p>

<h3 id="secure-package-secpkg-specification">Secure package (<code>.secpkg</code>) specification</h3>

<p>A secure package (<code>.secpkg</code> file) contains a JSON object with the
following keys:</p>

<pre><code>{
  &quot;Name&quot;: &quot;the project's package name&quot;,
  &quot;Head&quot;: &quot;head of project's Codechain&quot;,
  &quot;DNS&quot;: &quot;fully qualified domain name&quot;,
  &quot;URL&quot;: &quot;URL to download project files of the from (URL/head.tar.gz)&quot;
}
</code></pre>

<p>Example <code>.secpkg</code> file for Codechain itself:</p>

<pre><code>{
  &quot;Name&quot;: &quot;codechain&quot;,
  &quot;Head&quot;: &quot;73fe1313fd924854f149021e969546bce6052eca0c22b2b91245cb448410493c&quot;,
  &quot;DNS&quot;: &quot;codechain.secpkg.net&quot;,
  &quot;URL&quot;: &quot;http://frankbraun.org/codechain&quot;
}
</code></pre>

<h4 id="install-specification">Install specification</h4>

<p>Installing software described by a <code>.secpkg</code> file works as follows:</p>

<ol>
<li><p>Parse .secpkg file and validate it. Save head as HEAD_PKG.</p></li>

<li><p>Make sure the project with NAME has not been installed before. That
is, the directory <code>~/.config/secpkg/pkgs/NAME</code> does not exist.</p></li>

<li><p>Create directory <code>~/.config/secpkg/pkgs/NAME</code></p></li>

<li><p>Save <code>.secpkg</code> file to <code>~/.config/secpkg/pkgs/NAME/.secpkg</code></p></li>

<li><p>Query TXT record from _codechain.DNS and validate the signed head
contained in it. Save head from TXT record (HEAD_SSOT).</p></li>

<li><p>Store the signed head to <code>~/.config/secpkg/pkgs/NAME/signed_head</code></p></li>

<li><p>Download distribution file from URL/HEAD_SSOT.tar.gz and save it to
<code>~/.config/secpkg/pkgs/NAME/dists</code></p></li>

<li><p>Apply <code>~/.config/secpkg/pkgs/NAME/dists/HEAD_SSOT.tar.gz</code> to<br />
<code>~/.config/secpkg/pkgs/NAME/src</code> with<br />
<code>codechain apply -f ~/.config/secpkg/pkgs/NAME/dists/HEAD_SSOT.tar.gz -head HEAD_SSOT</code></p></li>

<li><p>Make sure HEAD_PKG is contained in<br />
<code>~/.config/secpkg/pkgs/NAME/src/.codchain/hashchain</code></p></li>

<li><p>Copy <code>~/.config/secpkg/pkgs/NAME/src</code> to<br />
<code>~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p>Call <code>make prefix=~/.config/secpkg/local</code> in<br />
<code>~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p>Call <code>make prefix= ~/.config/secpkg/local install</code> in<br />
<code>~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p>Move <code>~/.config/secpkg/pkgs/NAME/build</code> to<br />
<code>~/.config/secpkg/pkgs/NAME/installed</code></p></li>
</ol>

<p>If the installation process fails at any stage during the procedure
described above, report the error and remove the directory
<code>~/.config/secpkg/pkgs/NAME</code>.</p>

<p>For the process above to work, the projects distributed as secure
packages must contain a Makefile (for GNU Make) with the &ldquo;all&rdquo; target
building the software and the &ldquo;install&rdquo; target installing it.</p>

<p>The software must be self-contained without any external dependencies,
except for the compiler. For Go software that means at least Go 1.11
must be installed (with module support) and all dependencies must be
vendored.</p>

<h4 id="update-specification">Update specification</h4>

<p>Updating a software package with NAME works as follows:</p>

<ol>
<li><p>Make sure the project with NAME has been installed before. That is,
the directory <code>~/.config/secpkg/pkgs/NAME</code> exists.</p></li>

<li><p>Load .secpkg file from <code>~/.config/secpkg/pkgs/NAME/.secpkg</code></p></li>

<li><p>Load signed head from <code>~/.config/secpkg/pkgs/NAME/signed_head</code> (as
DISK)</p></li>

<li><p>Query TXT record from _codechain.DNS, if it is the same as DISK,
goto 15.</p></li>

<li><p>Validate signed head from TXT and store HEAD:</p>

<ul>
<li>pubKey from TXT must be the same as pubKey or pubKeyRotate from
DISK.</li>
<li>The counter from TXT must be larger than the counter from DISK.</li>
<li>The signed head must be valid (as defined by validFrom and
validTo).</li>
</ul>

<p>If the validation fails, abort update procedure and report error.</p></li>

<li><p>If signed head from TXT record is the same as the one from DISK:</p>

<ul>
<li>Copy <code>~/.config/secpkg/pkgs/NAME/signed_head</code> to<br />
<code>~/.config/secpkg/pkgs/NAME/previous_signed_head</code></li>
<li>Save new signed head to <code>~/.config/secpkg/pkgs/NAME/signed_head</code>
(atomic).</li>
<li>Goto 15.</li>
</ul></li>

<li><p>Download distribution file from URL/HEAD.tar.gz and save it to
<code>~/.config/secpkg/pkgs/NAME/dists</code></p></li>

<li><p>Apply <code>~/.config/secpkg/pkgs/NAME/dists/HEAD.tar.gz</code> to<br />
<code>~/.config/secpkg/pkgs/NAME/src</code> with<br />
<code>codechain apply -f ~/.config/secpkg/pkgs/NAME/dists/HEAD.tar.gz -head HEAD</code>.</p></li>

<li><p><code>rm -rf ~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p><code>cp -r ~/.config/secpkg/pkgs/NAME/src ~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p>Call <code>make prefix=~/.config/secpkg/local</code> in<br />
<code>~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p>Call <code>make prefix= ~/.config/secpkg/local install</code> in<br />
<code>~/.config/secpkg/pkgs/NAME/build</code></p></li>

<li><p><code>mv ~/.config/secpkg/pkgs/NAME/build ~/.config/secpkg/pkgs/NAME/installed</code></p></li>

<li><p>Update signed head:</p>

<ul>
<li>Copy <code>~/.config/secpkg/pkgs/NAME/signed_head</code> to<br />
<code>~/.config/secpkg/pkgs/NAME/previous_signed_head</code></li>
<li>Save new signed head to <code>~/.config/secpkg/pkgs/NAME/signed_head</code>
(atomic).</li>
</ul></li>

<li><p>The software has been successfully updated.</p></li>
</ol>

<h2 id="implementation-in-codechain">Implementation in Codechain</h2>

<p>The specifications given above are implemented in <a href="in Go">Codechain</a>.
Codechain contains three tools for different user roles:</p>

<ol>
<li><p><code>codechain</code> for developers to record code changes and corresponding
multi-party reviews in a unmodifiable hash chain.</p></li>

<li><p><code>ssotpub</code> for admins to publish the head of a hash chain created by
<code>codechain</code> with a SSOT using DNS TXT records, creating a <code>.secpkg</code>
file in the process.</p></li>

<li><p><code>secpkg</code> for users to securely install and update software
distributed as <code>.secpkg</code> files.</p></li>
</ol>

<h3 id="codechain-goals">Codechain goals</h3>

<ul>
<li>Signed multiparty code reviews.</li>
<li>Easy &amp; built-in key rotation.</li>
<li>Protection against $5 wrench attack.</li>
<li>Regression protection, unmodifiable history.</li>
<li>Minimal usable implementation written in Go as soon as possible.</li>
<li>Focus on <strong>source</strong> distribution, not binary.</li>
<li>Single source of truth (SSOT).</li>
</ul>

<p>Out-of-scope:</p>

<ul>
<li>Source code management (just use Git).</li>
<li>Code distribution (minimal support is provided via
<code>codechain createdist</code> and <code>codechain apply -f</code>, both are used by
<code>secpkg</code>).</li>
</ul>

<h4 id="tree-hash-implementation">Tree hash implementation</h4>

<p>In Codechain tree hashes and tree lists are implemented in the <a href="https://godoc.org/github.com/frankbraun/codechain/tree">tree
package</a> and available through the <code>codechain treehash</code> command.</p>

<p>Example use:</p>

<pre><code>$ cd $GOPATH/src/github.com/frankbraun/codechain/doc/helloproject

$ codechain treehash -l
f ab81f3080f71a034c90dc0ca64b62295d3a75a23ec1b0f498dfda4a34325ae3a README.md
f ad125cc5c1fb680be130908a0838ca2235db04285bcdd29e8e25087927e7dd0d hello.go

$ codechain treehash
d844cbe6f6c2c29e97742b272096407e4d92e6ac7f167216b321c7aa55629716

$ codechain treehash -l | sha256sum
d844cbe6f6c2c29e97742b272096407e4d92e6ac7f167216b321c7aa55629716
</code></pre>

<h4 id="hash-chain-implementation">Hash chain implementation</h4>

<p>The hash chain file format is implemented in the <a href="https://godoc.org/github.com/frankbraun/codechain/hashchain">hashchain package</a>,
look there for an example hash chain.</p>

<h4 id="patchfile-implementation">Patchfile implementation</h4>

<p>The patchfile format is implemented in the <a href="https://godoc.org/github.com/frankbraun/codechain/patchfile">patchfile package</a>.</p>

<h4 id="ssot-via-dns-implementation">SSOT via DNS implementation</h4>

<p>SSOT with DNS TXT records is implemented in the <a href="https://godoc.org/github.com/frankbraun/codechain/ssot">SSOT package</a>.</p>

<h4 id="secure-package-implementation">Secure package implementation</h4>

<p>Secure packages are implemented in the <a href="https://godoc.org/github.com/frankbraun/codechain/secpkg">secpkg package</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The design for secure software development and distribution with secure
multiparty code reviews and a SSOT described in this document and
implemented in Codechain gives us</p>

<ul>
<li>globally identical,</li>
<li>verifiable,</li>
<li>reproducible, and</li>
<li>attributable</li>
</ul>

<p>binaries build from source, which is a <em>technical mitigation</em> against
one of the most likely results of further crypto regulation attempts,
so-called <em>targeted updates</em>.</p>

<p>We built a minimal solution in order to be able to use it for our own
software, but I hope that others will build upon it and improve the
design and/or implementation to close what I believe is a gaping
security hole in the area of software updates.</p>

<h4 id="future-work-platform-vendors">Future work: platform vendors</h4>

<p>While many open-source software distributions came a long way towards
<em>verifiable build processes</em> (see <a href="https://reproducible-builds.org/">Reproducible Builds</a>), they often
lack in the area of <em>secure software distribution</em> and <em>secure software
development</em>. The most common signing mechanism used by open-source
software projects and distributions nowadays&mdash;a single GPG
signature&mdash;is not sufficient for secure software development. And we
are not aware of any secure software distribution mechanism employed by
distributions today that guarantees that the installed software is the
same as on all devices.</p>

<p>We believe a design like the one described in this document and
implementations like <a href="https://github.com/frankbraun/codechain">Codechain</a> could be used to improve that situation
for open-source distributions, make targeted backdoors impossible there,
and by advancing the state-of-the-art put pressure on commercial vendors
to implement similar mechanisms.</p>

<p>In my opinion, the following open-source operating systems are the best
candidates: <a href="https://archlinux.org/">Arch Linux</a>, <a href="https://gentoo.org/">Gentoo Linux</a>, and <a href="https://openbsd.org/">OpenBSD</a>.</p>

<p>For commercial OS vendors especially Apple, with their newfound focus on
privacy and security that is aligned with their core business, seems to
be a viable candidate.</p>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>Codechain and this paper have been heavily influenced by discussions
with <a href="https://github.com/JonathanLogan">Jonathan Logan</a> of <a href="https://secure.cryptohippie.com/">Cryptohippie</a>, Inc.</p>
</main>
    <footer>
  

</footer>
    



  </body>
</html>
